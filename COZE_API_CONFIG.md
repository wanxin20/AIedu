# Coze API 配置说明

## 🔑 API Token 配置

请在 `src/services/gradingApi.ts` 文件中替换 API Token：

```typescript
// 第 2 行
const API_TOKEN = 'pat_YOUR_TOKEN_HERE'; // ⚠️ 需要替换为你的实际 token
```

### 如何获取 Token？

1. 访问 Coze 控制台：https://www.coze.cn/space/7453845303109238824
2. 进入你的 Bot 设置页面
3. 找到 API Token / Personal Access Token
4. 复制 token（格式通常为 `pat_xxxxxxxxxxxx`）
5. 替换到 `gradingApi.ts` 文件中

---

## 📝 使用说明

### 智能体信息
- **Bot ID**: `7559774554567000110`
- **功能**: 作业批改
- **输入**: 作业图片 URL
- **输出**: 批改结果（分数 + 评语）

### 集成位置
- **文件**: `src/pages/Teacher/AssignmentProgressDetail.tsx`
- **按钮**: "AI 智能批改"
- **功能**: 自动批改学生作业

### 工作流程

1. 教师点击"批改"按钮，选择某个学生的作业
2. 点击"AI 智能批改"按钮
3. 系统获取学生上传的作业图片
4. 调用 Coze API，将图片传给智能体
5. 显示流式输出（实时显示 AI 分析过程）
6. 批改完成后，自动提取分数和评语
7. 教师可以进一步编辑或直接提交

---

## 🎯 功能特性

### ✅ 已实现功能

1. **流式输出**: 实时显示 AI 批改过程
2. **自动解析**: 从 AI 返回的文本中自动提取分数和评语
3. **错误处理**: 完善的错误提示和重试机制
4. **加载状态**: 清晰的加载动画和进度提示
5. **图片验证**: 自动检查是否有作业图片
6. **样式优化**: 美观的渐变按钮和流式输出显示

### 📊 批改结果格式

智能体返回的文本应包含：
- **分数**: 如"得分：90"、"评分：85分"等
- **评语**: 详细的批改意见和建议

示例格式：
```
得分：92

批改意见：
1. 整体解题思路清晰，步骤完整
2. 第3题计算过程有小错误
3. 建议加强公式运用练习

优点：...
需改进：...
```

---

## 🔧 API 调试

### 测试 API 连接

```bash
# 在项目根目录执行
npm run dev
```

然后：
1. 登录系统（教师账号）
2. 进入"作业管理" → 选择一个作业 → 点击"查看进度"
3. 点击某个学生的"批改"按钮
4. 点击"AI 智能批改"
5. 查看浏览器控制台（F12）是否有错误信息

### 常见问题

**Q1: 提示"API 请求失败: 401"？**
- 检查 Token 是否正确
- 确认 Token 没有过期
- 确认 Bot ID 是否正确

**Q2: 提示"未找到作业图片"？**
- 确认学生已上传作业
- 检查图片 URL 是否可访问

**Q3: 无法提取分数？**
- 检查智能体返回的文本格式
- 调整 `parseGradingResult` 函数中的正则表达式

---

## 📖 API 文档参考

- **Coze API 文档**: https://www.coze.cn/open/docs/developer_guides#c5ac4993
- **你的智能体**: https://www.coze.cn/space/7453845303109238824/bot/7559774554567000110

---

## 🚀 部署注意事项

在部署到生产环境前：

1. ✅ 确保 API Token 已正确配置
2. ✅ 测试 API 调用是否正常
3. ✅ 检查图片 URL 是否可从服务器访问
4. ✅ 确认 CORS 跨域问题已解决
5. ✅ 建议将 Token 存储在环境变量中（而不是硬编码）

### 环境变量方式（推荐）

创建 `.env` 文件：
```bash
VITE_COZE_API_TOKEN=pat_your_actual_token_here
VITE_COZE_BOT_ID=7559774554567000110
```

修改 `gradingApi.ts`：
```typescript
const API_TOKEN = import.meta.env.VITE_COZE_API_TOKEN;
const BOT_ID = import.meta.env.VITE_COZE_BOT_ID;
```

---

## 💡 优化建议

1. **缓存机制**: 对相同作业的批改结果进行缓存
2. **批量批改**: 支持一次批改多个学生的作业
3. **自定义提示词**: 根据学科调整智能体的批改标准
4. **历史记录**: 保存所有 AI 批改记录
5. **评分调整**: 允许教师在 AI 评分基础上微调

---

如有问题，请参考 API 文档或联系技术支持。

