# 一键部署指南 - 智慧教辅系统

域名：edu.gptpro.cn  
端口：3003（仅用于备选方案）  
推荐：**Nginx 静态托管**

---

## ⚡ 最快部署方式（3 步完成）

### 第 1 步：服务器环境准备

SSH 连接到服务器后，运行：

```bash
# 下载并运行服务器配置脚本（或手动上传 server-setup.sh）
curl -O https://your-domain/server-setup.sh
chmod +x server-setup.sh
sudo ./server-setup.sh
```

或手动安装：
```bash
sudo apt update
sudo apt install nginx -y
sudo mkdir -p /var/www/edu-platform
sudo chown -R www-data:www-data /var/www/edu-platform
```

### 第 2 步：本地构建和部署

**修改 deploy.sh：**
```bash
# 编辑 deploy.sh，修改服务器信息
vim deploy.sh

# 找到这一行，改成你的服务器 IP
SERVER_HOST="123.45.67.89"  # 改成实际IP
```

**运行部署脚本：**
```bash
# 安装依赖（首次）
npm install

# 一键部署
./deploy.sh
```

脚本会自动完成：
- ✅ 清理旧文件
- ✅ 构建生产版本
- ✅ 上传到服务器
- ✅ 设置权限
- ✅ 重启 Nginx

### 第 3 步：配置 Nginx

在服务器上：

```bash
# 1. 创建 Nginx 配置（或手动创建并上传 nginx.conf）
sudo nano /etc/nginx/sites-available/edu.gptpro.cn

# 粘贴以下内容：
server {
    listen 80;
    server_name edu.gptpro.cn;
    root /var/www/edu-platform;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# 2. 启用站点
sudo ln -s /etc/nginx/sites-available/edu.gptpro.cn /etc/nginx/sites-enabled/

# 3. 测试并重启
sudo nginx -t
sudo systemctl restart nginx
```

### 完成！🎉

访问 http://edu.gptpro.cn 查看效果。

---

## 🔐 配置 SSL（可选但强烈推荐）

```bash
# 安装 Certbot
sudo apt install certbot python3-certbot-nginx -y

# 自动配置 SSL
sudo certbot --nginx -d edu.gptpro.cn

# 按提示输入邮箱并同意协议
```

配置完成后，网站会自动重定向到 HTTPS。

---

## 📋 完整部署检查清单

### 服务器端
- [ ] Nginx 已安装并运行
- [ ] 创建了 `/var/www/edu-platform` 目录
- [ ] 权限设置为 `www-data:www-data`
- [ ] Nginx 配置文件已创建
- [ ] 配置文件已链接到 sites-enabled
- [ ] Nginx 配置测试通过（`nginx -t`）

### 本地端
- [ ] 项目依赖已安装（`npm install`）
- [ ] 构建成功（`npm run build`）
- [ ] `deploy.sh` 中的服务器 IP 已修改
- [ ] 部署脚本已执行

### DNS 配置
- [ ] 域名 A 记录指向服务器 IP
- [ ] DNS 解析已生效（`ping edu.gptpro.cn`）

### 验证
- [ ] 网站可以正常访问
- [ ] 路由跳转正常（SPA 路由）
- [ ] 静态资源加载正常
- [ ] SSL 证书有效（如已配置）

---

## 🔄 日常更新部署

修改代码后，只需运行：

```bash
./deploy.sh
```

脚本会自动完成构建和部署。

---

## 📁 文件说明

| 文件 | 说明 |
|------|------|
| `deploy.sh` | 本地部署脚本，自动构建并上传 |
| `server-setup.sh` | 服务器环境配置脚本 |
| `nginx.conf` | Nginx 完整配置文件 |
| `ecosystem.config.js` | PM2 配置文件（备选方案） |
| `DEPLOY_README.md` | 详细部署文档 |
| `deploy.md` | 完整部署指南（包含两种方案） |

---

## ❓ 常见问题

### Q1: 访问显示 Nginx 默认页面？
**A:** 检查 Nginx 配置是否正确启用：
```bash
ls -la /etc/nginx/sites-enabled/
sudo systemctl restart nginx
```

### Q2: 页面刷新后 404？
**A:** 确保 Nginx 配置包含 SPA 路由支持：
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### Q3: 部署脚本连接失败？
**A:** 检查：
1. 服务器 IP 是否正确
2. SSH 密钥是否配置
3. 防火墙是否开放 22 端口

### Q4: SSL 证书申请失败？
**A:** 确保：
1. 域名已正确解析到服务器
2. 80 端口可访问
3. 没有其他证书冲突

---

## 🆘 需要帮助？

**查看日志：**
```bash
# Nginx 错误日志
sudo tail -f /var/log/nginx/error.log

# Nginx 访问日志
sudo tail -f /var/log/nginx/access.log
```

**测试配置：**
```bash
# 测试 Nginx 配置
sudo nginx -t

# 重新加载配置
sudo systemctl reload nginx
```

**检查服务状态：**
```bash
# Nginx 状态
sudo systemctl status nginx

# 查看端口占用
sudo lsof -i :80
sudo lsof -i :443
```

---

## 📞 技术支持

如遇到问题，请提供：
1. 错误信息或截图
2. Nginx 错误日志
3. 服务器系统信息（`uname -a`）
4. Nginx 版本（`nginx -v`）

祝部署顺利！🚀

